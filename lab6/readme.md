# 微處理機系統與介面技術 - LAB 6

## 實驗簡介
本次實驗利用 NUC140 微控制器的 Timer 模組實現計時功能，透過計數器分別每秒計數 2 次與 3 次，並在 Putty 終端顯示。實驗包含按鍵控制計數器暫停與啟動的功能，實現雙計數器獨立控制。此外，進一步優化程式僅使用單一 Timer 完成所有功能。

## 實驗器材
- **NUC140 V2.0 開發板**
- **UART to USB 模組**（PL2303HXA 或 CH340G）
- **Putty 軟體**（用於終端模擬）

## 實驗功能
### 基本功能
- 使用 Timer0 計數，每秒觸發中斷 2 次，並顯示於終端。
- 使用 Timer1 計數，每秒觸發中斷 3 次，並顯示於終端。

### 加分功能
1. 按鍵 Key1 暫停或啟動 Timer0 計數。
2. 按鍵 Key2 暫停或啟動 Timer1 計數。
3. 計數器獨立運作，按鍵僅影響對應的計數器。

### 實現方式
1. **單 Timer 版本 (V2)**：
   - 僅使用 Timer0，設為每秒觸發 1000 次中斷。
   - 透過條件判斷和模運算，在每 500 次中斷更新計數器 1，每 333 次中斷更新計數器 2。
   - 整合所有按鍵控制功能，精簡程式結構。

2. **多 Timer 版本 (V3)**：
   - 使用兩個 Timer，Timer0 每秒觸發 2 次中斷，Timer1 每秒觸發 3 次中斷，分別更新計數器。
   - 按鍵功能實現對應計數器的控制與重置。



## 實驗步驟
1. **硬體接線**：
   - 將 UART0 的 RX (PB0) 接至 USB 模組的 TX，TX (PB1) 接至 USB 模組的 RX。
   - 按鍵輸入 (PA0-PA5) 設定為輸出和輸入模式。
2. **軟體設置**：
   - 使用多 Timer 或單 Timer 模式配置 Timer0 和 Timer1 的週期模式。
   - 配置按鍵掃描函數，讀取按鍵值以控制計數器。
3. **程式運行**：
   - 啟動程式，在 Putty 終端每秒更新顯示兩個計數器的值。
   - 測試按鍵功能控制計數器暫停、啟動及重置。

## 系統架構
### 程式結構
- **main.c**：
  - `SYS_Init`：初始化系統時鐘和多功能腳位。
  - `UART0_Init`：初始化 UART，設置波特率。
  - `TIMER_Open`：設定 Timer 的週期模式與頻率。
  - `TIMER_EnableInt`：啟用 Timer 中斷。
  - `ScanKey1`：掃描按鍵值，控制計數器狀態。
  - `TMR0_IRQHandler`：Timer0 的中斷服務函數，用於觸發計數與控制。

### Timer 配置
- **單 Timer 模式 (V2)**：
  - Timer0 設為每秒觸發 1000 次，透過模運算決定更新頻率。
- **多 Timer 模式 (V3)**：
  - Timer0 每秒觸發 2 次，計數器 1 更新。
  - Timer1 每秒觸發 3 次，計數器 2 更新。


## 成果展示
- Putty 終端輸出範例：
